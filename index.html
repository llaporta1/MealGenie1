<!-- Updated HTML -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MealGenie</title>
  <style>
    /* (Unchanged styles for brevity) */
    /* Add your existing styles here */
    .appliances-group {
      margin-bottom: 15px;
    }

    .appliances-group label {
      display: inline-block;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>MealGenie</h1>
  <p class="description">Welcome to MealGenie! Simply input the ingredients you have at home, and we'll suggest recipes based on your preferences. You can also set dietary restrictions, appliance preferences, and nutrition targets for a more personalized experience.</p>

  <form id="ingredientsForm">
    <label for="ingredients">Ingredients:</label>
    <input type="text" id="ingredients" placeholder="Enter ingredients separated by commas">

    <!-- Toggle button to show or hide filters -->
    <div class="toggle-filters" onclick="toggleFilters()">Click to add dietary restrictions, appliance options, and filters</div>

    <!-- Hidden section for dietary restrictions and filters -->
    <div id="filtersContainer">
      <!-- (Existing dietary restrictions section) -->

      <label>Available Appliances:</label>
      <div class="appliances-group">
        <label><input type="checkbox" name="appliance" value="oven"> Oven</label>
        <label><input type="checkbox" name="appliance" value="microwave"> Microwave</label>
        <label><input type="checkbox" name="appliance" value="stovetop"> Stovetop</label>
        <label><input type="checkbox" name="appliance" value="air fryer"> Air Fryer</label>
        <label><input type="checkbox" name="appliance" value="slow cooker"> Slow Cooker</label>
      </div>
    </div>

    <button type="submit">Search Recipes</button>
  </form>

  <ul id="recipeList"></ul>

  <script>
    const API_KEY = '1347d10be1b547dc8f72ebd4fbe20ac5';  // Your API key
    const API_URL = `https://api.spoonacular.com/recipes/complexSearch`;

    function toggleFilters() {
      const filtersContainer = document.getElementById('filtersContainer');
      filtersContainer.style.display = filtersContainer.style.display === 'none' ? 'block' : 'none';
    }

    async function fetchRecipes(ingredients, diets, minCalories, maxCalories, minProtein, maxProtein, appliances) {
      const query = encodeURIComponent(ingredients);
      let url = `${API_URL}?includeIngredients=${query}&number=10&ranking=1&apiKey=${API_KEY}`;

      // Add dietary restrictions if selected
      if (diets.length > 0) {
        const dietQuery = diets.join(',');
        url += `&diet=${encodeURIComponent(dietQuery)}`;
      }

      // Add calorie and protein range if specified
      if (minCalories) {
        url += `&minCalories=${minCalories}`;
      }
      if (maxCalories) {
        url += `&maxCalories=${maxCalories}`;
      }
      if (minProtein) {
        url += `&minProtein=${minProtein}`;
      }
      if (maxProtein) {
        url += `&maxProtein=${maxProtein}`;
      }

      // Add appliances if specified
      if (appliances.length > 0) {
        const appliancesQuery = appliances.join(',');
        url += `&appliances=${encodeURIComponent(appliancesQuery)}`; // Adjust this parameter based on API capability
      }

      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`API call failed with status: ${response.status}`);
        }
        const data = await response.json();
        return data.results;
      } catch (error) {
        console.error('Error fetching recipes:', error);
        return [];
      }
    }

    document.getElementById('ingredientsForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const ingredients = document.getElementById('ingredients').value.trim();
      const dietCheckboxes = document.querySelectorAll('input[name="diet"]:checked');
      const diets = Array.from(dietCheckboxes).map(checkbox => checkbox.value);

      const applianceCheckboxes = document.querySelectorAll('input[name="appliance"]:checked');
      const appliances = Array.from(applianceCheckboxes).map(checkbox => checkbox.value);

      const minCalories = document.getElementById('minCalories').value;
      const maxCalories = document.getElementById('maxCalories').value;
      const minProtein = document.getElementById('minProtein').value;
      const maxProtein = document.getElementById('maxProtein').value;

      if (!ingredients) {
        alert('Please enter some ingredients.');
        return;
      }

      const recipes = await fetchRecipes(ingredients, diets, minCalories, maxCalories, minProtein, maxProtein, appliances);
      displayRecipes(recipes);
    });

    function displayRecipes(recipes) {
      const recipeList = document.getElementById('recipeList');
      recipeList.innerHTML = '';

      if (recipes.length === 0) {
        recipeList.innerHTML = '<p>No recipes found. Please try different ingredients or appliances.</p>';
        return;
      }

      recipes.forEach(recipe => {
        const recipeUrl = `https://spoonacular.com/recipes/${recipe.title.toLowerCase().replace(/ /g, "-")}-${recipe.id}`;

        const listItem = document.createElement('li');
        listItem.style.marginBottom = '20px';

        listItem.innerHTML = `
          <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
            <h3 style="color: #333;">${recipe.title}</h3>
            <img src="${recipe.image}" alt="${recipe.title}" style="width: 100%; max-width: 300px; height: auto;" />
            <a href="${recipeUrl}" target="_blank" style="color: #28a745;">View Recipe</a>
          </div>
        `;

        recipeList.appendChild(listItem);
      });
    }
  </script>
</body>
</html>
